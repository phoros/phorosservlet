<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>

<link type="text/css" rel="stylesheet" href="@coreCss@" title="Core CSS" />

<style>
svg { fill : #ddd; }


.site {fill : red; }


.map {
    border: solid 2px blue;
}
</style>

</head>
<body>

<header role="banner">
<nav role="navigation">
@projectlabel@:  <a href="@homeUrl@">home</a>
</nav>
</header>


<article role="main">

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var urn = location.search.split('urn=')[1];
var csvUrl = "http://localhost:8080/phorosservlet/place.groovy?urn=" + urn 

function layoutPage(csv) {
    var site = csv[0].SiteName;
    var urn = csv[0].Urn;
    var title = d3.select("header").append("title").text("Site " + site);
    var h1 = d3.select("body").append("h1").text("Site " + site);
    var p = d3.select("body").append("p").text(urn);
}

function plotMap(csv) {
var lon = csv[0].Lon;
var lat = csv[0].Lat;

var width = 250,
height = 200;


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
d3.json("aegean.topojson", function(error, greece) {
    var pt1 = {
	"type": "Point",
	"coordinates": [
	    lon,lat
	]
    }
    var coast = topojson.feature(greece, greece.objects.aegean);

    var proj = d3.geo.mercator()
	.center([44,32])
	.scale([1100])
    ;

    var path = d3.geo.path()
	.projection(proj)
	.pointRadius(5);

    svg.append("path")
	.datum(coast)
	.attr("d",path);

    svg.append("path")
	.datum(pt1)
	.attr("class", "site")
        .attr("urn",urn)
	.attr("d",path);
});

}

function addFooter() {
    d3.select("body").append("footer").text("@htmlfooter@");
}

d3.csv(csvUrl,
       function(csv) {
	   layoutPage(csv);
	   plotMap(csv);
	   addFooter();
       });
</script>
</article>


</body>
</html>
